{% import "partials/table.html" as table %}
{% import "partials/bag_card.html" as bag_card %}

<div id="bag-list" class="mt-6 space-y-8" data-star-scope="bags">
  {% if !open_bags.is_empty() %}
  <section>
    <h2 class="text-lg font-semibold text-amber-700 mb-3">Open Bags</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for bag in open_bags %}
      {% call bag_card::card(bag, is_authenticated) %}
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <section>
    <h2 class="text-2xl font-bold mb-4 text-stone-800">History</h2>
    <div class="rounded-lg border border-amber-300 bg-amber-100/80 shadow-sm"
      {% if bags.has_next() %}data-infinite-scroll data-next-url="{{ navigator.fragment_page_href(bags.next_page().unwrap())|safe }}" data-target="#bag-list"{% endif %}
    >
      {% call table::search_header(navigator, "#bag-list") %}

      <div class="overflow-x-auto">
        <table class="responsive-table min-w-full divide-y divide-amber-200 text-left text-sm text-stone-700">
          <thead class="bg-amber-200/60 text-xs font-semibold tracking-wide text-amber-900">
            <tr>
              {% call table::sortable_header("Added", "created-at", navigator, "#bag-list") %}
              {% call table::sortable_header("Roaster", "roaster", navigator, "#bag-list") %}
              {% call table::sortable_header("Roast", "roast", navigator, "#bag-list") %}
              <th scope="col" class="px-4 py-3">Weight</th>
              {% call table::sortable_header("Finished", "finished-at", navigator, "#bag-list") %}
            </tr>
          </thead>
          <tbody class="divide-y divide-amber-200/70">
            {% for bag in bags.items %}
            <tr class="bg-amber-50/40 transition hover:bg-amber-50">
              <td data-label="Added" class="whitespace-nowrap px-4 py-3 text-xs font-medium text-stone-600">
                {{ bag.created_at }}
              </td>
              <td data-label="Roaster" class="px-4 py-3 whitespace-nowrap font-medium text-stone-600">
                {{ bag.roaster_name }}
              </td>
              <td data-label="Roast" class="px-4 py-3 whitespace-nowrap">{{ bag.roast_name }}</td>
              <td data-label="Weight" class="px-4 py-3 whitespace-nowrap">{{ bag.amount }}g</td>
              <td data-label="Finished" class="px-4 py-3 whitespace-nowrap">{{ bag.finished_at }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% call table::pagination_header(bags, navigator, "#bag-list") %}
      {% if bags.has_next() %}
      <div class="infinite-scroll-sentinel h-4 md:hidden" aria-hidden="true"></div>
      {% endif %}
    </div>
  </section>
</div>

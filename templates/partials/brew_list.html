{% import "partials/table.html" as table %}

<div id="brew-list" class="mt-6" data-star-scope="brews">
  {% if brews.items.is_empty() && !navigator.has_search() %}
  <div
    class="rounded-lg border border-dashed border-amber-300 bg-amber-100/40 px-4 py-6 text-sm text-stone-600"
  >
    <p class="text-center">
      No brews logged yet. Use the form above to log your first brew.
    </p>
  </div>
  {% else %}
  <section class="rounded-lg border border-amber-300 bg-amber-100/80 shadow-sm"
    {% if brews.has_next() %}data-infinite-scroll data-next-url="{{ navigator.fragment_page_href(brews.next_page().unwrap())|safe }}" data-target="#brew-list"{% endif %}
  >
    {% call table::search_header(navigator, "#brew-list") %}

    <div class="overflow-x-auto">
      <table class="responsive-table min-w-full divide-y divide-amber-200 text-left text-sm text-stone-700">
        <thead class="bg-amber-200/60 text-xs font-semibold tracking-wide text-amber-900">
          <tr>
            {% call table::sortable_header("Added", "created-at", navigator, "#brew-list") %}
            <th scope="col" class="px-4 py-3">Coffee</th>
            <th scope="col" class="px-4 py-3">Grind</th>
            <th scope="col" class="px-4 py-3">Recipe</th>
            <th scope="col" class="px-4 py-3">Brewer</th>
            {% if is_authenticated %}
            <th scope="col" class="px-4 py-3 text-center">Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody class="divide-y divide-amber-200/70">
          {% for brew in brews.items %}
          <tr class="bg-amber-50/40 transition hover:bg-amber-50">
            <td data-label="Added" class="whitespace-nowrap px-4 py-3 text-xs font-medium text-stone-600">
              {{ brew.created_at }}
            </td>
            <td data-label="Coffee" class="px-4 py-3 whitespace-nowrap">
              <div class="font-medium text-stone-800">
                <a href="/roasters/{{ brew.roaster_slug }}/roasts/{{ brew.roast_slug }}" class="hover:text-amber-700 hover:underline">
                  {{ brew.roast_name }}
                </a>
              </div>
              <div class="hidden md:block text-xs text-stone-500">
                <a href="/roasters/{{ brew.roaster_slug }}" class="hover:text-amber-700 hover:underline">
                  {{ brew.roaster_name }}
                </a>
              </div>
            </td>
            <td data-label="Roaster" class="px-4 py-3 whitespace-nowrap md:hidden">
              <a href="/roasters/{{ brew.roaster_slug }}" class="hover:text-amber-700 hover:underline">
                {{ brew.roaster_name }}
              </a>
            </td>
            <td data-label="Grind" class="px-4 py-3 whitespace-nowrap">
              <div>{{ brew.grind_setting }}</div>
              <div class="hidden md:block text-xs text-stone-500">{{ brew.grinder_name }}</div>
            </td>
            <td data-label="Grinder" class="px-4 py-3 whitespace-nowrap md:hidden">{{ brew.grinder_name }}</td>
            <td data-label="Recipe" class="px-4 py-3 whitespace-nowrap">
              <div>{{ brew.coffee_weight }} / {{ brew.water_volume }}</div>
              <div class="hidden md:block text-xs text-stone-500">{{ brew.ratio }} Â· {{ brew.water_temp }}</div>
            </td>
            <td data-label="Ratio" class="px-4 py-3 whitespace-nowrap md:hidden">{{ brew.ratio }}</td>
            <td data-label="Temp" class="px-4 py-3 whitespace-nowrap md:hidden">{{ brew.water_temp }}</td>
            <td data-label="Brewer" class="px-4 py-3 whitespace-nowrap">
              <div>{{ brew.brewer_name }}</div>
              {% if let Some(fp_name) = brew.filter_paper_name %}
              <div class="hidden md:block text-xs text-stone-500">{{ fp_name }}</div>
              {% endif %}
            </td>
            {% if let Some(fp_name) = brew.filter_paper_name %}
            <td data-label="Filter" class="px-4 py-3 whitespace-nowrap md:hidden">{{ fp_name }}</td>
            {% endif %}
            {% if is_authenticated %}
            <td data-label="" class="px-4 py-3 text-right">
              <div class="inline-flex items-center gap-1">
                <form class="inline" data-on:submit="@post('/api/v1/brews?{{ navigator.query() }}', {contentType: 'form', responseOverrides: {selector: '#brew-list', mode: 'replace'}})">
                  <input type="hidden" name="bag_id" value="{{ brew.bag_id }}" />
                  <input type="hidden" name="coffee_weight" value="{{ brew.coffee_weight_raw }}" />
                  <input type="hidden" name="grinder_id" value="{{ brew.grinder_id }}" />
                  <input type="hidden" name="grind_setting" value="{{ brew.grind_setting_raw }}" />
                  <input type="hidden" name="brewer_id" value="{{ brew.brewer_id }}" />
                  {% if let Some(fp_id) = brew.filter_paper_id %}
                  <input type="hidden" name="filter_paper_id" value="{{ fp_id }}" />
                  {% endif %}
                  <input type="hidden" name="water_volume" value="{{ brew.water_volume_raw }}" />
                  <input type="hidden" name="water_temp" value="{{ brew.water_temp_raw }}" />
                  <button
                    type="submit"
                    class="inline-flex h-8 w-8 items-center justify-center rounded-md text-stone-500 transition hover:text-amber-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-500"
                    title="Brew again"
                  >
                    <span class="sr-only">Brew again</span>
                    <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path
                        fill-rule="evenodd"
                        d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0v2.43l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389 5.5 5.5 0 0 1 9.2-2.466l.312.311h-2.433a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.22Z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </button>
                </form>
                <button
                  type="button"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-md text-stone-500 transition hover:text-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"
                  title="Delete brew"
                  data-on:click="confirm('Delete this brew?') && @delete('/api/v1/brews/{{ brew.id }}?{{ navigator.query() }}', {responseOverrides: {selector: '#brew-list', mode: 'replace'}})"
                >
                  <span class="sr-only">Delete</span>
                  <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path
                      fill-rule="evenodd"
                      d="M7.5 3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1H15a1 1 0 1 1 0 2h-.4l-.74 10.36A2 2 0 0 1 11.87 17H8.13a2 2 0 0 1-1.99-1.64L5.4 5H5a1 1 0 1 1 0-2h2.5Zm.9 4.5a.75.75 0 0 1 .75.75v6a.75.75 0 1 1-1.5 0v-6a.75.75 0 0 1 .75-.75Zm3.4 0a.75.75 0 0 1 .75.75v6a.75.75 0 1 1-1.5 0v-6a.75.75 0 0 1 .75-.75Z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </button>
              </div>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if brews.items.is_empty() %}
    <div class="p-8 text-center text-stone-500">
      No brews match your search.
    </div>
    {% endif %}

    {% call table::pagination_header(brews, navigator, "#brew-list") %}

    {% if brews.has_next() %}
    <div class="infinite-scroll-sentinel h-4 md:hidden" aria-hidden="true"></div>
    {% endif %}
  </section>
  {% endif %}
</div>

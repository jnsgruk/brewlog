{% import "partials/table.html" as table %}
{% import "partials/icons.html" as icons %}

<div id="roaster-list" class="mt-6" data-star-scope="roasters">
  {% if roasters.items.is_empty() && !navigator.has_search() %}
  <div
    class="rounded-lg border border-dashed border-amber-300 bg-amber-100/40 px-4 py-6 text-sm text-stone-600"
  >
    <p class="text-center">
      {% if is_authenticated %}
      No roasters added yet. Click the Add button to create your first roaster.
      {% else %}
      No roasters added yet.
      {% endif %}
    </p>
  </div>
  {% else %}
  <section class="rounded-lg border border-amber-300 bg-amber-100/80 shadow-sm"
    {% if roasters.has_next() %}data-infinite-scroll data-next-url="{{ navigator.fragment_page_href(roasters.next_page().unwrap())|safe }}" data-target="#roaster-list"{% endif %}
  >
    {% call table::search_header(navigator, "#roaster-list") %}
    <div class="overflow-x-auto">
      <table class="responsive-table min-w-full divide-y divide-amber-200 text-left text-sm text-stone-700">
        <thead class="bg-amber-200/60 text-xs font-semibold tracking-wide text-amber-900">
          <tr>
            {% call table::sortable_header("Added", "created-at", navigator, "#roaster-list") %}
            {% call table::sortable_header("Name", "name", navigator, "#roaster-list") %}
            {% call table::sortable_header("Location", "country", navigator, "#roaster-list") %}
            <th scope="col" class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-amber-200/70">
          {% for roaster in roasters.items %}
          <tr
            data-star-key="{{ roaster.id }}"
            data-sort-created-at="{{ roaster.created_at_sort_key }}"
            data-sort-name="{{ roaster.name }}"
            data-sort-country="{{ roaster.country }}"
            data-sort-city="{{ roaster.city }}"
            class="bg-amber-50/40 transition hover:bg-amber-50"
          >
            <td data-label="Added" class="card-date whitespace-nowrap px-4 py-3 text-xs font-medium text-stone-600">
              {{ roaster.created_at }}
            </td>
            <td data-label="Name" class="card-title px-4 py-3 font-medium text-stone-800">
              {{ roaster.name }}
            </td>
            <td data-label="Location" class="px-4 py-3 whitespace-nowrap">
              {{ roaster.country }}
              {% if !roaster.city.is_empty() %}
              <div class="hidden md:block text-xs text-stone-500">{{ roaster.city }}</div>
              {% endif %}
            </td>
            {% if !roaster.city.is_empty() %}
            <td data-label="City" class="px-4 py-3 whitespace-nowrap md:hidden">{{ roaster.city }}</td>
            {% endif %}
            <td data-label="" class="card-actions px-4 py-3 text-right">
              <div class="hidden md:inline-flex items-center gap-1">
                {% if roaster.has_homepage %}
                <a
                  class="inline-flex h-8 w-8 items-center justify-center rounded-md text-stone-500 transition hover:text-amber-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-500"
                  href="{{ roaster.homepage_url }}"
                  target="_blank"
                  rel="noreferrer noopener"
                  title="Visit homepage"
                >
                  <span class="sr-only">Visit {{ roaster.name }} homepage</span>
                  {% call icons::external_link("h-4 w-4") %}
                </a>
                {% endif %}
                {% if is_authenticated %}
                <button
                  type="button"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-md text-stone-500 transition hover:text-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500"
                  title="Delete roaster"
                  data-on:click="confirm('Delete this roaster?') && @delete('/api/v1/roasters/{{ roaster.id }}?{{ navigator.query() }}', {responseOverrides: {selector: '#roaster-list', mode: 'replace'}})"
                >
                  <span class="sr-only">Delete</span>
                  {% call icons::delete("h-4 w-4") %}
                </button>
                {% endif %}
              </div>
              {% if roaster.has_homepage || is_authenticated %}
              <details class="card-menu md:hidden">
                <summary>{% call icons::ellipsis_vertical("h-5 w-5") %}</summary>
                <div class="card-menu-items">
                  {% if roaster.has_homepage %}
                  <a href="{{ roaster.homepage_url }}" target="_blank" rel="noreferrer noopener">
                    {% call icons::external_link("h-4 w-4") %} Visit homepage
                  </a>
                  {% endif %}
                  {% if is_authenticated %}
                  <button type="button" class="menu-item-danger"
                    data-on:click="this.closest('details').open = false; confirm('Delete this roaster?') && @delete('/api/v1/roasters/{{ roaster.id }}?{{ navigator.query() }}', {responseOverrides: {selector: '#roaster-list', mode: 'replace'}})">
                    {% call icons::delete("h-4 w-4") %} Delete
                  </button>
                  {% endif %}
                </div>
              </details>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% if roasters.items.is_empty() %}
    <div class="p-8 text-center text-stone-500">No roasters match your search.</div>
    {% endif %}
    {% call table::pagination_header(roasters, navigator, "#roaster-list") %}
    {% if roasters.has_next() %}
    <div class="infinite-scroll-sentinel h-4 md:hidden" aria-hidden="true"></div>
    {% endif %}
  </section>
  {% endif %}
</div>
